\documentclass[12pt]{article}

\usepackage{sbc-template}

\usepackage{graphicx,url}

%\usepackage[brazil]{babel}   
\usepackage[latin1]{inputenc}  

     
\sloppy

\title{ERLANGMS: Uma Plataforma em Erlang/OTP para 
Modernização de Sistemas Legados através de uma Abordagem Orientada a Serviços na UnB}

\author{
	Everton Agilar\inst{1},
	Alysson Ribeiro\inst{1},
	Renato Ribeiro\inst{1},
	Eliene Vieira\inst{1},
}


\address{Universidade de Brasília -- Campus Universitário Darcy Ribeiro\\
   Caixa Postal -- 70910-90  -- Brasília -- DF -- Brasil
  \email{\{evertonagilar,rcarauta,alyssondsr,elienev\}@unb.br}
}


\begin{document} 

\maketitle

%\begin{abstract}
%  This meta-paper describes the style to be used in articles and short papers
%  for SBC conferences. For papers in English, you should add just an abstract
%  while for the papers in Portuguese, we also ask for an abstract in
%  Portuguese (``resumo''). In both cases, abstracts should not have more than
%  10 lines and must be in the first page of the paper.
%\end{abstract}

     
\begin{resumo} 
Nos últimos anos, a modernização dos sistemas legados da Universidade de Brasília (UnB) tem sido 
prioridade para o CPD/UnB. 
A Arquitetura Orientada a Serviços (SOA) surge como uma maneira de solucionar 
este problema, disponibilizando uma abstração de alto nível entre as aplicações e a camada de negócio ou serviço.
Este artigo aborda este tema e descreve alguns resultados obtidos com o uso 
da plataforma ERLANGMS desenvolvido pelo CPD/UnB sob 
uma abordagem orientada a serviços que compreende um processo 
de moderniza\c c\~{a}o e um barramento aderente ao estilo 
arquitetural \textit{Representational State Transfer} (REST). 
Mais especificamente, são discutidos os principais resultados alcançados, 
as quais destacam-se um barramento de serviços 
orientado a contrato de serviços; 
um kit de desenvolvimento (SDK) para criação de serviços; 
um processo denominado SMSOC para guiar as 
atividades de migração de sistemas legados; 
e alguns serviços de apoio 
como um proxy LDAP para unificar o login de usuários e um serviço de autenticação/autorização OAuth2
para os serviços em REST.
\end{resumo}


\section{Introdução}

Os sistemas legados correspondem às aplicações que sustentam o funcionamento 
negocial de uma Instituição e consolidam a maior parte das informações corporativas~\cite{S4_bennett1995legacy,S3_Bisbal:1999}. 
Na Universidade de Brasília (UnB), há uma gama considerável de sistemas legados desenvolvido 
ao longo dos últimos 30 anos pelo CPD/UnB que consistem em um arcabouço 
de regras de negócios que são de vital importância para o 
pleno funcionamento da Instituição. Entretanto, com as 
sucessivas revisões nas regras de negócios para mantê-los alinhados
com as necessidades e a obsolescência tecnológica desses sistemas, 
tornaram-se rígidos e inflexíveis, a ponto de serem de difícil manutenção e evolução. 

De forma geral, os sistemas da UnB dividem-se em
três áreas de negócio: área acadêmica, administrativa e de pessoal.
A maioria desses sistemas foram construídos em diferentes linguagens de programação,
arquiteturas e plataformas que não conversam entre
si, a não ser, por meio do banco de dados. Durante muitos anos,
a linguagem de programação VB foi a predominante. Os dois sistemas mais
importantes escritos em VB são o \emph{Sistema Acadêmico (SIGRA)} e
o \emph{Sistema de Pessoal (SIPES)}, sendo os demais sistemas escritos
em VB.Net, C\#, PHP, ASP e Java (a plataforma atual). 

Neste cenário, as tradicionais práticas de manutenção deixam 
de atender \`{a}s organizações, que buscam formas de reduzir 
os custos com a manutenção, maximizar a integração entre os sistemas,
torná-los mais flexíveis às mudanças de forma para prolongar sua vida útil e facilitar a evolução
desses sistemas~\cite{S4_bennett1995legacy,S3_Bisbal:1999,S15_Comella-DordaASurvey2000}. 


Ao conduzir a modernização dos sistemas legados na UnB,
optou-se por experimentar com a arquitetura orientada a servi\c cos, particularmente 
seguindo o estilo arquitetural \emph{REST}, já adotado 
em muitas Instituições devido ao aproveitamento da infraestrutura web existente e 
a facilidade para invocar serviços REST a apartir de qualquer sistema~\cite{fielding2000architectural,kalin2013java}. 
Assim, foi criada a plataforma \emph{ERLANGMS}, 
que compreende um barramento de serviços desenvolvido na linguagem \emph{Erlang/OTP}
para possibilitar a publicação de serviços; de um processo de modernização
denominado \emph{Software Modernization through Service Oriented Computing (SMSOC)}, 
para guiar os trabalhos de modernização e disponibilizar uma arquitetura de 
software padronizada para criação dos serviços.

Salienta-se que embora \emph{SOA} seja um tema
de crescente interesse por parte dos pesquisadores e da indústria, identificou-se 
a necessidade prévia de condução de um mapeamento sistemático para 
caracterizar a modernização de sistemas legados no 
contexto da manutenção de software~\cite{desystematic2016}. 
Desse modo, muitas decisões de design da plataforma proposta
foram definidas a partir deste estudo prévio onde verificou-se
que a maior parte das contribuições na literatura
estão relacionados aos aspectos gerenciais da modernização de software (55,88\% das
publicações) e há poucos relatos de contribuições que descrevem (ou validem)
técnicas ou ferramentas de modernização de software.


Este artigo apresenta a plataforma ERLANGMS e discute as
experiências obtidas na implantação do barramento de serviços no CPD/UnB. Mais especificamente, são 
descritos os principais resultados alcançados, as quais destacam-se:

\begin{itemize}

\item Utilização do processo de modernização SMSOC

\item Logon único para os sistemas da UnB

\item Controle de acesso aos serviços

\item 

\item Desenvolvimento de um serviço de autenticação OAuth2, 
integrado ao Sistema de Controle de Acesso (SCA) da UnB, que permite 
que os serviços possam ser consumidos pelos clientes utilizando 
a mesma infraestrutura de segurança já existente.

\end{itemize} 



\section{Plataforma ERLANGMS}

A plataforma ERLANGMS é constituído por 
um barramento de serviços (\textit{Enterprise Service Bus}-- ESB) multiplataforma,
de um kit de desenvolvimento (SDK) para 
implementar os serviços na linguagem 
Java\footnote{Está em desenvolvimento o SDK .Net para implementação de serviços nas linguagens C\# eVB.Net.} e
um processo de modernização denominado SMSOC. 
O barramento de serviços
foi idealizado para servir de elo entre os 
sistemas da Universidade e a camada de serviço (tipicamente 
implementada usando a linguagem Java). 
De acordo com \cite{SOAPractice:2007}, um barramento permite unificar o acesso aos serviços 
através de uma camada intermediadora entre componentes de software (denominados serviços) e 
as aplicações que consomem estes serviços. 
A implementa\c c\~{a}o 
de um novo barramento (em vez da ado\c c\~{a}o de um barramento existente), 
possibilitou uma melhor compreens\~{a}o do estilo arquitetural REST e o dom\'{i}nio de alguns 
elementos chave propostos no ErlangMS, como a estrutura de eventos e os recursos de toler\^{a}ncia 
a falha. 

A arquitetura segue o conceito de \textit{Service Oriented Computing} (SOC), 
um paradigma que promove a composição de serviços \emph{em uma rede de serviços} 
fracamente acoplados, com o objetivo de criar processos de negócio dinâmicos 
e flexíveis através da interconexão de sistemas computacionais~\cite{SOAIntBlueprint:2010}. 
Dessa forma, o barramento suporta a mediação, roteamento, 
transformação de dados e a orquestração dos serviços. Para isso, adotou-se o 
estilo arquitetural REST e o formato JSON para o envio e 
recebimento das mensagens do cliente. Essa restrição de design teve o 
objetivo de facilitar a implementação do barramento e mantê-lo simples. 

O esquema de comunicação da arquitetura ocorre por meio de 
duas vias distintas, como ilustra a Figura~\ref{fig:roteamento_mensagens}: Na primeira via, 
existe a comunicação do cliente para 
consumir algum serviço no barramento. Essa comunicação é via uma 
interface REST, razão pela qual o cliente (que pode ser qualquer sistema, 
independente da sua linguagem de programação ou plataforma) 
precisa suportar chamadas de serviços em REST. Na segunda via, tem a comunicação 
do barramento com o serviço, que está implementado em 
alguma linguagem de programação (Erlang, Java, etc.). Essa comunicação dá-se via
sistema de mensageria disponível em Erlang que possibilita uma comunicação assíncrona 
com várias linguagens de programação de forma muito rápida por trafegar os dados 
no formato binário e com baixa latência na rede\cite{Armstrong:2013:PES:2566708}.

\begin{figure}[htb]
\centering
\includegraphics[scale=0.9]{img/arquitetura/roteamento_mensagens.pdf}
\caption{Esquema do roteamento das mensagens na plataforma ERLANGMS.}
\label{fig:roteamento_mensagens}
\end{figure}


Uma das vantagens que se observou na abordagem proposta foi permitir que tanto 
os sistemas novos quanto os sistemas legados possam coexistir, invocando os mesmos serviços e
maximizando o compartilhamento das regras de negócio.


\section{Resultados}

\subsection{Utilização do processo de modernização SMSOC}

A introdução de um processo surgiu devido a necessidade
de documentar um processo de modernização 
para auxiliar os trabalhos de modernização.
O processo SMSOC é 
aderente à arquitetura SOA 
e foi validado como  
resultado de um estudo de caso
conduzido em uma disciplina de Pós-Graduação
do Mestrado Acadêmico em Informática da UnB,
através do qual foi modernizado 
o Sistema de Estudo Socio Economico (SAE)
que faz a gestão do processo de 
avaliação socioeconômica dos estudantes.

O processo de moderização compreende também a documentação sobre a arquitetura e o design
dos serviços implementados, denominado de kit de desenvolvimento (SDK). 


\subsection{Logon único para os sistemas da UnB}

A UnB tem buscado desde 2013 uma forma de unificar o acesso dos usuários aos
sistemas e a rede corporativa (Webmail e UnB Wireless), uma vez que existem muitos
silos de dados de usuários que dificultam a centralização dessas informações. 
Para suprir esta demanda e subsidiar a concretização do acesso 
unificado ao ambiente da UnB bem como o compartilhamento de informações 
com várias as aplicações,
até mesmo os sistemas não desenvolvidos pelo CPD/UnB, como é o caso do SEI e o Redmine,
foi implementado um serviço proxy LDAP ou Lightweight Directory Access Protocol 
no barramento de serviços que permite que a base de usuários possa
estar em um banco relacional onde os sistemas da UnB tem acesso direto mas
permite que os demais sistemas desenvolvidos ou não pelo CPD e os sites institucionais
possam autenticar os usuários e consultar informações desses usuários através
de um protocolo padrão.

\subsection{Solução de Autorização}
\label{authz}
\subsubsection{Requisitos}
Os requisitos da solução de autorização propostos neste trabalho, são: 
\begin{description}
	\item[Req1] \textbf {Autorização}. O protocolo deverá conceder autorizações apenas aos recursos que o cliente autenticado tenha direito. As autorizações serão válidas por um período de tempo finito.  
    \item[Req2] \textbf{Administrador}. O administrador do recurso deve ser capaz de revogar autorizações concedidas a qualquer momento.
	\item[Req3] \textbf{Integridade}. Deve ser possível detectar alterações ilícitas nas mensagens durante o processo de autenticação e autorização.
    \item[Req4] \textbf{Privacidade}. Dados restritos trocados durante o processo de autorização devem ser mantidos em sigilo de pessoas e serviços não autorizados;
    \item[Req5] \textbf{Compatibilidade com o barramento ErlangMS}. O protocolo deve usar a arquitetura REST e o formato JSON para troca de mensagens.
\end{description}

As soluções encontradas no Mapeamento Sistemático apresentado em \cite{7521451} e os requisitos definidos para a solução de segurança que será utilizada no barramento ErlangMS serviram de apoio para a escolha do protocolo de autorização.

Desta forma, foi implementado no protocolo  de autorização Oauth 2 como um serviço do ErlangMS. A implementação do OAuth  foi facilitada pelo uso das bibliotecas disponibilizadas no barramento e na linguagem Erlang para tratar requisições HTTP/REST. O ErlangMS já possui suporte ao uso de TLS, desta forma, o OAuth 2 foi implementado respeitando os requisitos de integridade e privacidade.

\subsubsection{OAuth 2}
O OAuth (\textit{Open Authorization Protocol}) é um protocolo de autorização que permite que um aplicativo de terceiros possa obter acesso limitado a um serviço através de trocas de mensagens e \textit{tokens} de acesso \cite{torroglosa2013integration}. O protocolo utiliza a arquitetura REST e mensagens JSON \cite{noureddine2013authentication}.


A versão do Oauth 2.0 traz um protocolo completamente novo em relação a versão 1.0, publicado em dezembro de 2007, não sendo compatível com o mesmo \cite{hammer2010introducing,hammer2010oauth}. O OAuth 2.0 define quatro entidades:

\begin{itemize}
\item \textit{Resource Owner}: é o usuário que autoriza uma aplicação a acessar seus dados;
\item \textit{Client}: aplicação que deseja acessar os dados do usuário;
\item \textit{Resource Server}: Servidor que hospeda os recursos protegidos, recebe e responde às solicitações de acesso aos  recursos com os \textit{tokens} do protocolo ;
\item \textit{Authorization Server}:  Servidor que concede o \textit{token} de acesso após verificar a identidade do usuário e a concessão da autorização ao cliente.
\end{itemize}

A Figura \ref{fun:fig:oauth} apresenta o fluxo abstrato do Oauth 2.0.

\begin{figure}[ht!]
	\begin{center}
		\includegraphics[scale = 0.8]{figuras/oauth.jpg}
		\caption{ Abstract Flux of Oauth 2.0 \cite{hardt2012oauth}}
		\label{fun:fig:oauth}
	\end{center}
\end{figure}  

As etapas do diagrama incluem:
\begin{description}
\item [(A) ] O cliente solicita uma autorização para acessar os recursos do usuário;
\item [(B) ] O usuário autoriza o pedido e o cliente recebe a concessão da autorização;
\item [(C) ] O cliente requisita o \textit{token} de acesso apresentando a concessão da autorização e suas credenciais ao servidor de autorização;
\item [(D) ] O servidor de autorização autentica o cliente, valida a concessão da autorização e emite o \textit{token} de acesso;
\item [(E) ] O cliente requisita o recurso protegido e apresenta o \textit{token} de acesso;
\item [(F) ] O servidor do recurso valida o \textit{token} de acesso e concede o acesso aos recursos solicitados.
\end{description}


\subsection{Controle de acesso aos serviços}

Com o desenvolvimento de sistemas com uma abordagem SOA, torna-se
importante controlar o acesso e a autorização no acesso aos dados disponibilizados como serviço.
Nesse sentido, foi desenvolvimento suporte para autenticação OAuth2. Este protocolo
ainda está em desenvolvimento e está sendo integrado ao sistema de controle de acesso 
da UnB.

\subsection{ serviço de autenticação OAuth2, integrado ao Sistema de Controle de Acesso (SCA) da UnB}

Para a integração do (SCA) com o protocolo oauth 2, o trabalho realizado teve como objetivo a criação de uma autenticação única e integrada para cada pessoa. Atualmente os perfis de acesso estão vinculados a um usuário, e vários usuários estão ligados a uma única pessoa. Para se ter um controle de acesso único e integrado é necessário associar todos os usuários a uma pessoa. Os seguintes passos foram feitos para padronização desse cenário.

\begin{itemize}
\item Foi criado uma consulta que retornasse todos os perfis e usuários da pessoa.
\item O resultado da consulta foi armazenado em um banco de dados interno do barramento para proporcionar maior velocidade na autenticação.
\item Foi desenvolvida um sistema cliente de autenticação para o acesso único e integrado aos sistemas da UNB. 
\end{itemize}
   
Os passos para a autenticação entre a aplicação cliente e o servidor de autorização seguem o seguinte fluxo. O usuário se autentica em uma aplciação cliente, que envia os dados de login e senha de acesso, por meio do SSL, ao receber o login e a senha o servidor autentica o usuário caso o login seja válido e retorna o token de acesso criptografado, que é armazenado pela aplicação cliente. Esse modelo permite que o usuário se autentique apenas uma vez e tenha acesso a todos os serviços que os perfis de acesso permitem.



ATÉ AQUI

\section{Metodos}

Atualmente, os sistemas da Universidade de Brasília (UNB) são protegidos por meio de um sistema de controle de acesso (SCA). Esse sistema proporciona a criação de permissões atráves de usuários que tem perfis e estes tem transações. Um dos problemas enfrentados com essa abordagem é o fato de que as aplicações da UNB estão vinculadas a pessoa, ou seja, uma pessoa pode ter diversos usuários diferentes. Outro problema enfrentado é o fato desse sistema, por ter sido implementado de forma proprietária, não está em conformidade com os padrões do mercado no que se refere a autenticação e autorização, o que impossibilita que sistemas externos a universidade possam compartilhar dessas informações.

A implementação de um framework padrão de mercado se torna necessária para a resolução dos diversos problemas mencionados. Com isso foi escolhido o oauth 2 por ser um framework autamente utilizado pelas maiores empresas de informatica e por ser hoje um padrão de mercado.

O oauth 2 é um framework que veio com a ideia de se padronizar a maneira como as aplicões cliente acessam conteúdo restrito. O oauth 2 se baseia em tokens de acesso. Ao se autenticar, uma aplicação cliente recebe do servidor de autorização um token de acesso. A aplicação cliente pode acessar os recursos restritos, basta apenas enviar o token recebido pelo servidor e este valida ou não o acesso aos dados requisitados.

Para a implantação do oauth 2 é necessário seguir uma série de passos preconizados pela rfc. Uma importante caracteristica, que faz com que o oauth 2 seja amplamente utilizado é sua obrigatoriedade de uso junto com o HTTS. 

Diversos serviços já estão disponibilizados como: a declaração de aluno, o catálogo de aluno, os cursos dos alunos, dentre outros. Todos os serviços ultilizam o barramento como comunicação entre as aplicações cliente e os dados armazenados no servidor.

Os serviços seguem um padrão, chamado de catálogos, que fornecem a url de acesso, qual a linguagem do serviço, onde está o código do serviço, seu método HTTP de acesso e a forma de autorização. 

Segue abaixo um exemplo de um dos serviços já disponibilizados.

\section{References}

\bibliographystyle{sbc}
\bibliography{bibliografia}

\end{document}
